<!-- Filter -->
<metal:block tal:condition="view/parent/filterSettings/filter_show">
    <div class="bibfolder-filter" tal:define="
        b_start python:request.get('b_start', 0);
        author request/filter.author | python: ' ';
        year request/filter.year | python: ' ';
        ">
        <form name="bibfolderfilter" id="bibfolderfilterform" action="" method="get"  class="form-inline">
            <span i18n:translate="text_show">Show</span>
            <span i18n:translate="text_by_author">by author:</span>  
            <select name="filter.author" class="form-control">
                <option i18n:translate="text_authors_all" value="">all</option>
                <metal:block tal:repeat="a view/parent/authorList">
                    <option tal:define="v python: a.replace(',', '')" tal:attributes="value v; selected python: v==author" tal:content="a">Cyril Tata</option>
                </metal:block>
            </select>
            <span i18n:translate="text_by_year">by year:</span>
            <select name="filter.year" class="form-control">
                <option i18n:translate="text_years_all" value="">all</option>
                <metal:block tal:repeat="y view/parent/yearsList">
                    <option tal:attributes="value y; selected python: y==year" tal:content="y">2015</option>
                </metal:block>
            </select>
            <input type="submit" value="Show" i18n:attributes="value label_show" class="btn" />
        </form>
    </div>
</metal:block>
<!-- Listing -->
<section tal:repeat="query view/parent/queries">
    <!-- grouping by years -->
    <div tal:condition="view/parent/filterSettings/filter_by_year">
        <metal:block tal:define="results python: view.parent.runQuery(query);">
            <metal:block tal:condition="results" tal:define="rkeys results/keys; dummy python:rkeys.sort(); dummy python:rkeys.reverse()">
                <h4 class="section-title"
                    tal:condition="python: query['labels']['display_label'] is not 'all'"
                    tal:content="query/labels/display_label"
                    ></h4>
                <div class="section-description"
                    tal:condition="python: query['labels']['display_desc'] and query['labels']['display_desc'] is not 'all'"
                    tal:content="query/labels/display_desc"
                    ></div>
                <metal:block tal:repeat="year rkeys">
                    <div class="year-group" tal:condition="python: year.lower() and (year.lower() == 'in press' or float(year) > 1900)">
                        <div class="year" tal:attributes="id year; name year" tal:content="year">1905</div>
                        <ul tal:define="items python: results[year]" class="bibfolder-items">
                            <metal:block
                                tal:repeat="result items"
                                tal:define="formatter nocall:context/@@bibfolderlistitemformatter">
                                <tal:item tal:replace="structure python:formatter(result)" />
                            </metal:block>
                        </ul>
                    </div>
                </metal:block>
            </metal:block>
        </metal:block>
    </div>
    <!-- not grouping by years -->
    <div tal:condition="not:view/parent/filterSettings/filter_by_year">
        <metal:block tal:define="results python: view.parent.runQuery(query)">
            <metal:block tal:condition="results">
                <h4 class="section-title"
                    tal:condition="python: query['labels']['display_label'] is not 'all'"
                    tal:content="query/labels/display_label"
                    ></h4>
                <div class="section-description"
                    tal:condition="python: query['labels']['display_desc'] and query['labels']['display_desc'] is not 'all'"
                    tal:content="query/labels/display_desc"
                    ></div>
                <ul class="bibfolder-items">
                    <metal:block
                        tal:repeat="result results"
                        tal:define="formatter nocall:context/@@bibfolderlistitemformatter">
                        <tal:item tal:replace="structure python:formatter(result)" />
                    </metal:block>
                </ul>
            </metal:block>
        </metal:block>
    </div>
</section>